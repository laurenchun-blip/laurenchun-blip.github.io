<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Manual Flow - Draggable Pin</title>
    <style>
      :root {
        --primary-blue: #2563eb;
        --border: #e5e7eb;
        --text-main: #1f2937;
        --text-muted: #6b7280;
      }
      body {
        font-family: sans-serif;
        background: #f3f4f6;
        padding: 40px;
        display: flex;
        justify-content: center;
        overflow: hidden;
      }
      .card {
        background: white;
        width: 500px;
        padding: 24px;
        border-radius: 12px;
        border: 1px solid var(--border);
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
      }

      .label-group {
        display: flex;
        justify-content: space-between;
        align-items: flex-end;
        margin-bottom: 8px;
      }
      .label-main {
        font-size: 14px;
        font-weight: 600;
      }

      .search-input {
        width: 100%;
        padding: 12px;
        border: 1px solid var(--border);
        border-radius: 6px;
        margin-bottom: 20px;
        font-size: 15px;
        box-sizing: border-box;
      }

      .control-panel {
        background: #f9fafb;
        border: 1px solid var(--border);
        border-radius: 8px;
        padding: 16px;
        margin-bottom: 20px;
      }
      input[type="range"] {
        width: 100%;
        accent-color: var(--primary-blue);
        cursor: pointer;
        margin: 10px 0;
      }

      /* Map and Draggable Pin */
      .map-container {
        height: 300px;
        background: #e5e7eb;
        background-image:
          linear-gradient(#d1d5db 1px, transparent 1px),
          linear-gradient(90deg, #d1d5db 1px, transparent 1px);
        background-size: 20px 20px; /* Mock map grid */
        border-radius: 8px;
        position: relative;
        overflow: hidden;
        cursor: crosshair;
      }

      .radius-circle {
        background: rgba(37, 99, 235, 0.15);
        border: 2px solid var(--primary-blue);
        border-radius: 50%;
        position: absolute;
        pointer-events: none; /* Let clicks pass through to the pin */
        transform: translate(-50%, -50%);
        transition:
          width 0.2s,
          height 0.2s;
      }

      .pin {
        position: absolute;
        font-size: 32px;
        cursor: grab;
        user-select: none;
        transform: translate(
          -50%,
          -100%
        ); /* Bottom of pin sits on coordinate */
        z-index: 100;
      }
      .pin:active {
        cursor: grabbing;
      }

      .hint-text {
        font-size: 12px;
        color: var(--text-muted);
        text-align: center;
        margin-bottom: 10px;
        font-style: italic;
      }

      .inventory-status {
        margin-top: 12px;
        padding: 12px;
        border-radius: 6px;
        font-size: 14px;
        font-weight: 600;
        text-align: center;
        transition: all 0.3s;
      }
      .found {
        background: #dcfce7;
        color: #166534;
        border: 1px solid #bbf7d0;
      }
      .none {
        background: #fee2e2;
        color: #991b1b;
        border: 1px solid #fecaca;
      }

      .btn-next {
        width: 100%;
        background: #111827;
        color: white;
        border: none;
        padding: 14px;
        border-radius: 6px;
        font-weight: 600;
        cursor: pointer;
        margin-top: 20px;
      }
    </style>
  </head>
  <body>
    <div class="card">
      <h3 style="margin-top: 0">Customize Coverage Area</h3>
      <input type="text" class="search-input" value="Oakland, CA" readonly />

      <div class="control-panel">
        <div class="label-group">
          <span class="label-main"
            >Radius:
            <span id="miles-val" style="color: var(--primary-blue)"
              >5 miles</span
            ></span
          >
        </div>
        <input type="range" id="radius-range" min="1" max="25" value="5" />
      </div>

      <p class="hint-text">Drag the pin to find signs in nearby pockets</p>

      <div class="map-container" id="map">
        <div id="visual-radius" class="radius-circle"></div>
        <div id="draggable-pin" class="pin">üìç</div>
        <div
          style="
            width: 500px;
            height: 300px;
            overflow: hidden;
            border: 1px solid #ccc;
          "
        >
          <img
            src="assets/map.jpg"
            style="width: 100%; height: 100%; object-fit: cover"
          />
        </div>
      </div>

      <div id="inventory-msg" class="inventory-status none">0 Signs found</div>

      <button class="btn-next">Confirm & Continue</button>
    </div>

    <script>
      const map = document.getElementById("map");
      const pin = document.getElementById("draggable-pin");
      const radiusCircle = document.getElementById("visual-radius");
      const slider = document.getElementById("radius-range");
      const milesVal = document.getElementById("miles-val");
      const status = document.getElementById("inventory-msg");

      let isDragging = false;
      let currentX = 300; // Initial center X
      let currentY = 165; // Initial center Y

      // Mock "Sign Pockets" (Coordinates on our 300x300 map)
      const pockets = [
        { x: 150, y: 180, density: 15 }, // "Downtown" pocket
        { x: 290, y: 80, density: 8 }, // "Suburban" pocket
        { x: 390, y: 80, density: 8 },
      ];

      function updateLogic() {
        // 1. Position Pin and Circle
        pin.style.left = currentX + "px";
        pin.style.top = currentY + "px";
        radiusCircle.style.left = currentX + "px";
        radiusCircle.style.top = currentY + "px";

        // 2. Scale Circle
        const radiusPx = slider.value * 8; // Scale factor for visuals
        radiusCircle.style.width = radiusPx * 2 + "px";
        radiusCircle.style.height = radiusPx * 2 + "px";
        milesVal.innerText = slider.value + " miles";

        // 3. Calculate "Inventory" based on distance to pockets
        let totalSigns = 0;
        pockets.forEach((p) => {
          const dist = Math.sqrt(
            Math.pow(p.x - currentX, 2) + Math.pow(p.y - currentY, 2),
          );
          // If pocket is within radius, add signs
          if (dist < slider.value * 8) {
            totalSigns += p.density;
          }
        });

        // 4. Update UI
        if (totalSigns > 0) {
          status.innerText = `‚úì ${totalSigns} Signs found in this zone`;
          status.className = "inventory-status found";
        } else {
          status.innerText = "0 Signs found. Drag the pin to a new area.";
          status.className = "inventory-status none";
        }
      }

      // Dragging Logic
      pin.addEventListener("mousedown", (e) => {
        isDragging = true;
        e.preventDefault();
      });
      window.addEventListener("mouseup", () => {
        isDragging = false;
      });

      window.addEventListener("mousemove", (e) => {
        if (!isDragging) return;

        const rect = map.getBoundingClientRect();
        let x = e.clientX - rect.left;
        let y = e.clientY - rect.top;

        // Constrain to map bounds
        currentX = Math.max(0, Math.min(x, 500));
        currentY = Math.max(0, Math.min(y, 500));

        updateLogic();
      });

      slider.addEventListener("input", updateLogic);

      // Initialize
      updateLogic();
    </script>
  </body>
</html>
